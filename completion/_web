#compdef web
#autoload


_web_bookmarks() {

    #get chrome bookmarks
    local -a ids descriptions bookmarks search sites

    #grab all CLI args, remove 'web' from start
    search=`echo $@ | sed -e '/^web /d'`
    sites=`web --complete $search`
    bookmarks=("${(f)${sites}}")

    #parse parts
    id_numbers=()
    descriptions=()

    _complete_help

    #terminal colors
    RESET=`echo -e "\033[0;0m"`
    WHITE=`echo -e "\033[0;37m"`
    BLUE=`echo -e "\033[4;34m"`
    CYAN=`echo -e "\033[0;36m"`

    #show bookmarks
    for bookmark in ${bookmarks[@]}; do
        local -a split
        split=("${(@s/:/)bookmark}")
        ids+=( $split[1] )
        descriptions+=( "$split[1] $split[2]$split[3] $BLUE$split[4]$RESET" )
    done

    #finally, add completions
    #_alternative "bookmarks:bookmarks:($bookmarks)"
    compadd -l -X 'found bookmarks:' -d descriptions -a ids
    return
}


_web() {
    _arguments\
        '(--search)--search[search google for...]'\
        '(-s)-s[search google for...]'\
        '(--bookmark)--bookmark[bookmark completion]'\
        '(-b)-b[bookmark completion]'\
        '*::bookmarks:->bookmarks' && return

    _web_bookmarks $words
}


_web
